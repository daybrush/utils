{"version":3,"file":"shapepoly.esm.js","sources":["../src/consts.ts","../src/index.ts"],"sourcesContent":["export const TOP = \"top\";\nexport const BOTTOM = \"bottom\";\nexport const LEFT = \"left\";\nexport const RIGHT = \"right\";\nexport type DIRECTION = \"top\" | \"bottom\" | \"left\" | \"right\";\nexport const REVERSE = {\n  [TOP]: BOTTOM,\n  [BOTTOM]: TOP,\n  [LEFT]: RIGHT,\n  [RIGHT]: LEFT,\n};\nexport const POLY_CLASS = \"__shape-poly\";\nexport const SIDE_CLASS = `${POLY_CLASS}-side`;\nexport const POSITION_ABSOLUTE = \"position:absolute;\";\nexport const SIDE_CSS = `${POSITION_ABSOLUTE}width:100%;height:100%;border-radius:inherit;\nbackground-color:inherit;transform-origin:inherit;`;\n","import { BOTTOM, TOP, DIRECTION, SIDE_CLASS, POLY_CLASS,\n  POSITION_ABSOLUTE, REVERSE, LEFT, RIGHT, SIDE_CSS } from \"./consts\";\n\nfunction splitUnit(text: string) {\n  const matches = /^([^\\d|e|\\-|\\+]*)((?:\\d|\\.|-|e-|e\\+)+)(\\S*)$/g.exec(text);\n\n  if (!matches) {\n    return { unit: \"\", value: NaN };\n  }\n  const value = matches[2];\n  const unit = matches[3];\n\n  return { unit, value: parseFloat(value) };\n}\nfunction getTransformOrigin(strokeWidth: string | number, isVertical: boolean) {\n  const x = isVertical ? strokeWidth : \"50%\";\n  const y = isVertical ? \"50%\" : strokeWidth;\n\n  return `transform-origin:${x} ${y};`;\n}\n\nfunction getHTML(no: number | string, style: string, content: string = \"\") {\n  return `<div class=\"${SIDE_CLASS}${no}\" style=\"${style}\">${content}</div>`;\n}\nfunction makeDOM(tag: string, className: string) {\n  const el = document.createElement(tag);\n\n  el.className = className;\n  return el;\n}\nfunction getSin(side: number) {\n  // sin([n / 2] * 180 / n)\n  return Math.sin(Math.floor(side / 2) * Math.PI / side);\n}\nfunction getCos(side: number) {\n  // cos(180 / n)\n  return Math.cos(Math.PI / side);\n}\nfunction getStarAngle(side: number, radius: number) {\n  const cos = getCos(side);\n\n  return 100 * cos  <= radius ? 0 :\n    Math.atan((cos - radius / 100) / Math.sin(Math.PI / side)) / Math.PI * 180;\n}\nfunction getSideSize(side: number, split: number,\n                     starAngle: number, strokeWidth: string | number) {\n  const starRatio = starAngle ? 1 / Math.cos(starAngle * Math.PI / 180) : 1;\n  let ratio = 1 / split;\n\n  if (side > 4) {\n    const sin = Math.sin(Math.PI / side);\n    const cos = Math.cos(Math.PI / side);\n\n    if (side % 4 === 0) {\n      // 2 * r * cos(180 / n) = w\n      // 2 * r * sin(180 / n) = size\n      ratio *= sin / cos;\n    } else if (side % 2 === 0) {\n      ratio *= sin;\n    } else {\n      // 2 * r * sin([n /2] * 180 / n) = w\n      // 2 * r * sin(180 / n) = size\n      ratio *= sin / getSin(side);\n    }\n  } else if (split === 1) {\n    return \"100%\";\n  }\n  ratio *= starRatio;\n\n  return `calc(100% * ${ratio} - ${strokeWidth} * ${ratio} + ${strokeWidth})`;\n}\nfunction getHeight(side: number, strokeWidth: string | number, isVertical: boolean) {\n  if (side % 4 === 0) {\n    return \"100%\";\n  }\n  const cos = getCos(side);\n\n  let ratio = 0;\n  if (side % 2 === 0) {\n    // w * cos = h (vertical)\n    // w / cos = h (horizontal)\n    ratio = isVertical ? cos : 1 / cos;\n  } else {\n    const sin = getSin(side);\n\n    if (isVertical) {\n      // 2 * r * sin([n /2] * 180 / n) = w\n      ratio = 0.5 / sin * (1 + cos);\n    } else {\n      // r * (1 + cos(180 / n)) = w\n      ratio = 2 * 1 / (1 + cos) * sin;\n    }\n  }\n  return `calc(100% * ${ratio} + ${strokeWidth} * ${1 - ratio})`;\n}\n\nfunction getFirstTransform(side: number, split: number, isVertical: boolean,\n                           starAngle: number, strokeValue: number, strokeUnit: string) {\n  const translateProperty = isVertical ? \"X\" : \"Y\";\n  const cos = Math.cos(starAngle * Math.PI / 180);\n\n  const arr = [];\n  if (side >= 4) {\n    arr.push(`translate${translateProperty}(-${50 * cos * split}%)`);\n    if (split > 1) {\n      arr.push(`translate${translateProperty}(${strokeValue / 2 * (cos * split - 1)}${strokeUnit})`);\n    }\n  }\n  if (starAngle !== 0) {\n    arr.push(`rotate(${starAngle}deg)`);\n  }\n  return arr.length > 0 ? `transform:${arr.join(\" \")};` : \"\";\n}\nexport function dom(el: HTMLElement) {\n  const strokeWidth = el.getAttribute(\"data-stroke-width\") || undefined;\n  const stroke = el.getAttribute(\"data-stroke\") || undefined;\n  const direction = (el.getAttribute(\"data-direction\") as DIRECTION) || undefined;\n\n  return poly({ strokeWidth, stroke, direction, container: el });\n}\ninterface PolyInterface {\n  side?: number;\n  split?: number;\n  strokeWidth: number | string;\n  className?: string;\n  starRadius?: number;\n  container?: HTMLElement;\n  direction?: DIRECTION;\n  stroke?: string;\n}\nexport function poly({\n  className = POLY_CLASS,\n  strokeWidth = 0,\n  side = 3,\n  split = 1,\n  starRadius = 100,\n  stroke = \"black\",\n  direction = BOTTOM,\n  container = makeDOM(\"div\", className),\n}: PolyInterface) {\n  const splitCount = split * (starRadius === 100 ? 1 : 2);\n  const {unit: strokeUnit, value: strokeValue} = splitUnit(`${strokeWidth}`);\n  const half = `${strokeValue / 2}${strokeUnit}`;\n  const reverseDirection = REVERSE[direction];\n  const isVertical = direction === TOP || direction === BOTTOM;\n  const directionProperty = isVertical ? LEFT : TOP;\n  const padding = getHeight(side, strokeWidth, isVertical);\n  const sign = direction === TOP || direction === RIGHT ? -1 : 1;\n  const starAngle = starRadius === 100 ? 0 : getStarAngle(side, starRadius);\n  const sideWidth = getSideSize(side, splitCount, starAngle, strokeWidth);\n  const width = isVertical ? sideWidth : strokeWidth;\n  const height = isVertical ? strokeWidth : sideWidth;\n  const externalAngle = 360 / side + 2 * starAngle;\n  let html;\n\n  for (let i = side - 1; i >= 0; --i) {\n    for (let j = splitCount - 1; j >= 0; --j) {\n      const no = i * splitCount + j;\n\n      if (no === 0) {\n        continue;\n      }\n      const transform = j === 0 ? `transform:rotate(${sign * externalAngle}deg)` :\n        (starAngle && j === splitCount / 2 ? `transform:rotate(${-sign * 2 * starAngle}deg)` : \"\");\n\n      html = getHTML(no, SIDE_CSS + `${directionProperty}:100%;\n      margin-${directionProperty}:-${strokeWidth};${transform}`, html);\n    }\n  }\n\n  const pos = side < 4 ? \"0\" : \"50%\";\n  const transformSplit = getFirstTransform(side, splitCount, isVertical, sign * starAngle, strokeValue, strokeUnit);\n  const sideHTML = getHTML(0, `${POSITION_ABSOLUTE}${reverseDirection}: 0;\n  ${directionProperty}:${pos};${transformSplit}${getTransformOrigin(half, isVertical)}\n  display:inline-block;width:${width};height:${height};border-radius:${half};\n  background:${stroke};`, html);\n\n  const percentHTML = getHTML(\"percent\", `position:relative;width:100%;padding-top:${padding}`);\n\n  if (getComputedStyle(container).position === \"static\") {\n    container.style.position = \"relative\";\n  }\n  container.insertAdjacentHTML(\"beforeend\", sideHTML + percentHTML);\n\n  return container;\n}\nexport function be(container: HTMLElement, {\n  strokeWidth = 0,\n  side = 3,\n  split = 1,\n  starRadius = 100,\n  stroke = \"black\",\n  direction = BOTTOM,\n}: PolyInterface) {\n\n}\nexport const VERSION = \"#__VERSION__#\";\n"],"names":["TOP","BOTTOM","LEFT","RIGHT","REVERSE","_a","POLY_CLASS","SIDE_CLASS","POSITION_ABSOLUTE","SIDE_CSS","splitUnit","text","matches","exec","unit","value","NaN","parseFloat","getTransformOrigin","strokeWidth","isVertical","x","y","getHTML","no","style","content","makeDOM","tag","className","el","document","createElement","getSin","side","Math","sin","floor","PI","getCos","cos","getStarAngle","radius","atan","getSideSize","split","starAngle","starRatio","ratio","getHeight","getFirstTransform","strokeValue","strokeUnit","translateProperty","arr","push","length","join","dom","getAttribute","undefined","stroke","direction","poly","container","_b","_c","_d","_e","_f","starRadius","_g","_h","_j","splitCount","_k","half","reverseDirection","directionProperty","padding","sign","sideWidth","width","height","externalAngle","html","i","j","transform","pos","transformSplit","sideHTML","percentHTML","getComputedStyle","position","insertAdjacentHTML","be","VERSION"],"mappings":"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"}
{"version":3,"file":"shapepoly.js","sources":["../src/consts.ts","../src/index.ts"],"sourcesContent":["export const TOP = \"top\";\nexport const BOTTOM = \"bottom\";\nexport const LEFT = \"left\";\nexport const RIGHT = \"right\";\nexport type DIRECTION = \"top\" | \"bottom\" | \"left\" | \"right\";\nexport const REVERSE = {\n  [TOP]: BOTTOM,\n  [BOTTOM]: TOP,\n  [LEFT]: RIGHT,\n  [RIGHT]: LEFT,\n};\nexport const POLY_CLASS = \"__shape-poly\";\nexport const SIDE_CLASS = `${POLY_CLASS}-side`;\nexport const POSITION_ABSOLUTE = \"position:absolute;\";\nexport const SIDE_CSS = `${POSITION_ABSOLUTE}width:100%;height:100%;border-radius:inherit;\nbackground-color:inherit;transform-origin:inherit;`;\n","import {\n  BOTTOM, TOP, DIRECTION, SIDE_CLASS, POLY_CLASS,\n  POSITION_ABSOLUTE, REVERSE, LEFT, RIGHT, SIDE_CSS\n} from \"./consts\";\n\nfunction splitUnit(text: string) {\n  const matches = /^([^\\d|e|\\-|\\+]*)((?:\\d|\\.|-|e-|e\\+)+)(\\S*)$/g.exec(text);\n\n  if (!matches) {\n    return { unit: \"\", value: NaN };\n  }\n  const value = matches[2];\n  const unit = matches[3];\n\n  return { unit, value: parseFloat(value) };\n}\nfunction getTransformOrigin(strokeWidth: string | number, isVertical: boolean) {\n  const x = isVertical ? strokeWidth : \"50%\";\n  const y = isVertical ? \"50%\" : strokeWidth;\n\n  return `transform-origin:${x} ${y};`;\n}\n\nfunction getHTML(no: number | string, style: string, content: string = \"\") {\n  return `<div class=\"${SIDE_CLASS}${no}\" style=\"${style}\">${content}</div>`;\n}\nfunction makeDOM(tag: string, className: string) {\n  const el = document.createElement(tag);\n\n  el.className = className;\n  return el;\n}\nfunction getSin(side: number) {\n  // sin([n / 2] * 180 / n)\n  return Math.sin(Math.floor(side / 2) * Math.PI / side);\n}\nfunction getCos(side: number) {\n  // cos(180 / n)\n  return Math.cos(Math.PI / side);\n}\nfunction getStarAngle(side: number, radius: number) {\n  const cos = getCos(side);\n\n  return 100 * cos <= radius ? 0 :\n    Math.atan((cos - radius / 100) / Math.sin(Math.PI / side)) / Math.PI * 180;\n}\nfunction getSideSize(side: number, split: number,\n                     starAngle: number, strokeWidth: string | number) {\n  const starRatio = starAngle ? 1 / Math.cos(starAngle * Math.PI / 180) : 1;\n  let ratio = 1 / split;\n\n  if (side > 4) {\n    const sin = Math.sin(Math.PI / side);\n    const cos = Math.cos(Math.PI / side);\n\n    if (side % 4 === 0) {\n      // 2 * r * cos(180 / n) = w\n      // 2 * r * sin(180 / n) = size\n      ratio *= sin / cos;\n    } else if (side % 2 === 0) {\n      ratio *= sin;\n    } else {\n      // 2 * r * sin([n /2] * 180 / n) = w\n      // 2 * r * sin(180 / n) = size\n      ratio *= sin / getSin(side);\n    }\n  } else if (split === 1) {\n    return \"100%\";\n  }\n  ratio *= starRatio;\n\n  return `calc(100% * ${ratio} - ${strokeWidth} * ${ratio} + ${strokeWidth})`;\n}\nfunction getHeight(side: number, strokeWidth: string | number, isVertical: boolean) {\n  if (side % 4 === 0) {\n    return \"100%\";\n  }\n  const cos = getCos(side);\n\n  let ratio = 0;\n  if (side % 2 === 0) {\n    // w * cos = h (vertical)\n    // w / cos = h (horizontal)\n    ratio = isVertical ? cos : 1 / cos;\n  } else {\n    const sin = getSin(side);\n\n    if (isVertical) {\n      // 2 * r * sin([n /2] * 180 / n) = w\n      ratio = 0.5 / sin * (1 + cos);\n    } else {\n      // r * (1 + cos(180 / n)) = w\n      ratio = 2 * 1 / (1 + cos) * sin;\n    }\n  }\n  return `calc(100% * ${ratio} + ${strokeWidth} * ${1 - ratio})`;\n}\n\nfunction getFirstTransform(side: number, split: number, isVertical: boolean,\n                           starAngle: number, strokeValue: number, strokeUnit: string) {\n  const translateProperty = isVertical ? \"X\" : \"Y\";\n  const cos = Math.cos(starAngle * Math.PI / 180);\n\n  const arr = [];\n  arr.push(`translate${translateProperty}(-${50 * cos * split}%)`);\n  if (split > 1) {\n    arr.push(`translate${translateProperty}(${strokeValue / 2 * (cos * split - 1)}${strokeUnit})`);\n  }\n  if (starAngle !== 0) {\n    arr.push(`rotate(${starAngle}deg)`);\n  }\n  return `transform:${arr.join(\" \")};`;\n}\n\nfunction getAttribute(el: HTMLElement, name: string) {\n  return el.getAttribute(`data-${name}`) || undefined;\n}\nexport function dom(el: HTMLElement) {\n  const strokeWidth = getAttribute(el, \"stroke-width\");\n  const stroke = getAttribute(el, \"stroke\");\n  const direction = getAttribute(el, \"direction\") as DIRECTION;\n  let side: string | number = getAttribute(el, \"side\");\n  let split: string | number = getAttribute(el, \"split\");\n  let starRadius: string | number = getAttribute(el, \"star-radius\");\n\n  side && (side = parseFloat(side));\n  split && (split = parseFloat(split));\n  starRadius && (starRadius = parseFloat(starRadius));\n\n  return poly({\n    side: (side as number),\n    split: (split as number),\n    starRadius: (starRadius as number),\n    strokeWidth, direction, stroke, container: el});\n}\ninterface PolyInterface {\n  side?: number ;\n  split?: number;\n  strokeWidth: number | string;\n  className?: string;\n  starRadius?: number;\n  container?: HTMLElement;\n  direction?: DIRECTION;\n  stroke?: string;\n}\nexport function css({\n  strokeWidth = 0,\n  side = 3,\n  split = 1,\n  starRadius = 100,\n  stroke = \"black\",\n  direction = BOTTOM,\n}: PolyInterface) {\n  const splitCount = split * (starRadius === 100 ? 1 : 2);\n  const { unit: strokeUnit, value: strokeValue } = splitUnit(`${strokeWidth}`);\n  const half = `${strokeValue / 2}${strokeUnit}`;\n  const reverseDirection = REVERSE[direction];\n  const isVertical = direction === TOP || direction === BOTTOM;\n  const directionProperty = isVertical ? LEFT : TOP;\n  const otherDirectionProperty = isVertical ? TOP : LEFT;\n  const padding = getHeight(side, strokeWidth, isVertical);\n  const sign = direction === TOP || direction === RIGHT ? -1 : 1;\n  const starAngle = starRadius === 100 ? 0 : getStarAngle(side, starRadius);\n  const sideWidth = getSideSize(side, splitCount, starAngle, strokeWidth);\n  const width = isVertical ? sideWidth : strokeWidth;\n  const height = isVertical ? strokeWidth : sideWidth;\n  const externalAngle = 360 / side + 2 * starAngle;\n  const transformSplit = getFirstTransform(side, splitCount, isVertical, sign * starAngle, strokeValue, strokeUnit);\n  const sides = [];\n\n  sides.push(`${reverseDirection}:0;\n  ${otherDirectionProperty}:auto;\n  ${directionProperty}:50%;${transformSplit}${getTransformOrigin(half, isVertical)}\n  width:${width};height:${height};border-radius:${half};background:${stroke};`);\n  for (let i = 0; i < side; ++i) {\n    for (let j = 0; j < splitCount; ++j) {\n      const no = i * splitCount + j;\n\n      if (no === 0) {\n        continue;\n      }\n      const transform = j === 0 ? `transform:rotate(${sign * externalAngle}deg)` :\n        (starAngle && j === splitCount / 2 ? `transform:rotate(${-sign * 2 * starAngle}deg)` : \"transform:none;\");\n\n      sides.push(`${otherDirectionProperty}:auto;${directionProperty}: calc(100% - ${strokeWidth});${transform}`);\n    }\n  }\n  return { sides, percent: `padding-top:${padding}` };\n}\nexport function be(el: HTMLElement, {\n  strokeWidth = 0,\n  side = 3,\n  starRadius = 100,\n  stroke = \"black\",\n  direction = BOTTOM,\n}: PolyInterface) {\n  const sideElements = el.querySelectorAll(`.${SIDE_CLASS}`);\n  const length = sideElements.length;\n  const split = length / (side * (starRadius !== 100 ? 2 : 1));\n  if (!length || split % 1) {\n    return;\n  }\n  const percentElement = el.querySelector(`.${SIDE_CLASS}-percent`);\n  const {sides, percent} = css({strokeWidth, side, split, starRadius, stroke, direction});\n\n  sides.forEach((sideCSS, i) => {\n    (sideElements[i] as any).style.cssText += sideCSS;\n  });\n  (percentElement as any).style.cssText += percent;\n}\nexport function poly({\n  className = POLY_CLASS,\n  strokeWidth = 0,\n  side = 3,\n  split = 1,\n  starRadius = 100,\n  stroke = \"black\",\n  direction = BOTTOM,\n  container = makeDOM(\"div\", className),\n}: PolyInterface) {\n  const {sides, percent} = css({strokeWidth, side, split, starRadius, stroke, direction});\n  let html;\n\n  for (let i = sides.length - 1; i >= 1; --i) {\n    html = getHTML(` ${SIDE_CLASS}${i}`, SIDE_CSS + sides[i], html);\n  }\n  html = getHTML(` ${SIDE_CLASS}0`, `${POSITION_ABSOLUTE}display:inline-block;${sides[0]}`, html);\n\n  const percentHTML = getHTML(\"-percent\", `position:relative;width:100%;${percent}`);\n\n  const position = getComputedStyle(container).position;\n\n  if (!position || position === \"static\") {\n    container.style.position = \"relative\";\n  }\n  container.insertAdjacentHTML(\"beforeend\", html + percentHTML);\n\n  return container;\n}\n\nexport const VERSION = \"#__VERSION__#\";\n"],"names":["TOP","BOTTOM","LEFT","RIGHT","REVERSE","_a","POLY_CLASS","SIDE_CLASS","POSITION_ABSOLUTE","SIDE_CSS","splitUnit","text","matches","exec","unit","value","NaN","parseFloat","getTransformOrigin","strokeWidth","isVertical","x","y","getHTML","no","style","content","makeDOM","tag","className","el","document","createElement","getSin","side","Math","sin","floor","PI","getCos","cos","getStarAngle","radius","atan","getSideSize","split","starAngle","starRatio","ratio","getHeight","getFirstTransform","strokeValue","strokeUnit","translateProperty","arr","push","join","getAttribute","name","undefined","dom","stroke","direction","starRadius","poly","container","css","_b","_c","_d","_e","_f","_g","splitCount","_h","half","reverseDirection","directionProperty","otherDirectionProperty","padding","sign","sideWidth","width","height","externalAngle","transformSplit","sides","i","j","transform","percent","be","sideElements","querySelectorAll","length","percentElement","querySelector","forEach","sideCSS","cssText","_j","_k","html","percentHTML","position","getComputedStyle","insertAdjacentHTML","VERSION"],"mappings":"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"}